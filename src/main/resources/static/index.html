<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do Manager</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <h1>To-Do-Manager</h1>
    <p>Herzlich Willkommen im To-Do-Manager. Dieses Projekt wurde im Rahmen einer Java-Übung 
        erstellt und beinhaltet ein Java-Backend (Spring Boot) und eine Web-Frontend (HTML, CSS und 
        JS). Viel Spass damit ^^.</p>
    <h2>To-Do erstellen</h2>
    <form id="todoForm">
        <label for="title">Titel:</label>
        <input type="text" id="title" name="title" required>
        <br><br>
        <label for="completed">Erledigt:</label>
        <input type="checkbox" id="completed" name="completed">
        <br><br>
        <button type="submit">Erstellen</button>
    </form>
    <br><br>

    <h2>To-Do-Liste</h2>
    <ul id="todoList"></ul>

    <!-- Bearbeitungsformular -->
    <form id="updateForm" style="display: none;">
        <h2>To-Do bearbeiten</h2>
        <label for="updateTitle">Titel:</label>
        <input type="text" id="updateTitle" name="title" required>
        <br><br>
        <label for="updateCompleted">Erledigt:</label>
        <input type="checkbox" id="updateCompleted" name="completed">
        <br><br>
        <button type="submit">Aktualisieren</button>
    </form>

    <script>
        const todoList = document.getElementById('todoList');
        const updateForm = document.getElementById('updateForm');
        const updateTitle = document.getElementById('updateTitle');
        const updateCompleted = document.getElementById('updateCompleted');
        let currentTodoId = null; // Speichert die ID des zu bearbeitenden To-Dos

        // Neues To-Do erstellen
        document.getElementById('todoForm').addEventListener('submit', async (event) => {
            event.preventDefault(); // Verhindert das Standard-Formularverhalten

            const title = document.getElementById('title').value;
            const completed = document.getElementById('completed').checked;

            const response = await fetch('http://localhost:8080/api/todos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, completed })
            });

            if (response.ok) {
                document.getElementById('title').value = "";
                document.getElementById('completed').checked = false;
                fetchTodos(); // To-Do-Liste aktualisieren
            } else {
                alert('Fehler beim Erstellen des To-Dos.');
            }
        });

        // To-Do-Liste abrufen
        async function fetchTodos() {
            const response = await fetch('http://localhost:8080/api/todos');
            const todos = await response.json();

            todoList.innerHTML = ''; // Liste leeren
            todos.forEach(todo => {
                const listItem = document.createElement('li');

                const textSpan = document.createElement('span');
                textSpan.textContent = todo.title + (todo.completed ? ' (erledigt)' : '');
                listItem.appendChild(textSpan);

                // Bearbeiten-Button
                const editButton = document.createElement('button');
                editButton.textContent = 'Bearbeiten';
                editButton.className = "liButton";
                editButton.style.marginLeft = '10px';
                editButton.addEventListener('click', () => {
                    currentTodoId = todo;
                    updateTitle.value = todo.title;
                    updateCompleted.checked = todo.completed;
                    currentTodoId = todo.id; // Speichere die ID des zu bearbeitenden To-Dos
                    updateForm.style.display = 'block'; // Bearbeitungsformular anzeigen
                });

                // Löschen-Button
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Löschen';
                deleteButton.className = "liButton";
                deleteButton.style.marginLeft = '10px';
                deleteButton.addEventListener('click', async () => {
                    await fetch(`http://localhost:8080/api/todos/${todo.id}`, { method: 'DELETE' });
                    fetchTodos(); // Liste aktualisieren
                });

                listItem.appendChild(editButton);
                listItem.appendChild(deleteButton);
                todoList.appendChild(listItem);
            });
        }

        // To-Do aktualisieren
        updateForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // Standard-Formularverhalten verhindern

            const updatedTitle = updateTitle.value;
            const updatedCompleted = updateCompleted.checked;

            const response = await fetch(`http://localhost:8080/api/todos/${currentTodoId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title: updatedTitle, completed: updatedCompleted })
            });

            if (response.ok) {
                alert('To-Do aktualisiert!');
                updateForm.style.display = 'none'; // Bearbeitungsformular ausblenden
                fetchTodos(); 
                currentTodoId = null;
            } else {
                alert('Fehler beim Aktualisieren des To-Dos.');
            }
        });

        // To-Dos laden, wenn die Seite geöffnet wird
        fetchTodos();
    </script>
</body>
</html>
